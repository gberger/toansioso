<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="TOAnsioso - Receba um email quando seu TOA chegar!">
  <meta name="author" content="Guilherme Berger">

  <meta property="og:image" content="http://i.imgur.com/bh3eCqQ.png"/>

  <title>TOAnsioso</title>

  <link href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" rel="stylesheet">
  <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>

  <style>
    body {
      padding-top: 40px;
      padding-bottom: 40px;
      background-color: #eee;
    }

    .container {
      max-width: 330px;
      padding: 15px;
      margin: 0 auto;
    }
    .form-signin .form-control {
      position: relative;
      height: auto;
      -webkit-box-sizing: border-box;
         -moz-box-sizing: border-box;
              box-sizing: border-box;
      padding: 10px;
      font-size: 16px;
    }
    .form-signin .form-control:focus {
      z-index: 2;
    }
    .form-control:first-child {
      margin-bottom: -1px;
      border-bottom-right-radius: 0;
      border-bottom-left-radius: 0;
    }
    .form-control:not(:first-child):not(:last-child) {
      margin-bottom: -1px;
      border-radius: 0;
    }
    .form-control:last-child {
      margin-bottom: 10px;
      border-top-left-radius: 0;
      border-top-right-radius: 0;
    }

    .footer {
      margin-top: 40px;
    }
  </style>    

</head>

<body>

  <div class="container">

    <img src="http://i.imgur.com/bh3eCqQ.png" alt="TOAnsioso" class="hidden"></img>

    <h1>TOAnsioso</h1>

    <div class="alerts"></div>

    <form class="form-signin toansioso-form" role="form" method="post" action="/register">
      <p>Nos campos "email" e "password", use seus dados do site do Grantee.</p>
      <p>Para o campo URL, vá ao <a href="https://mycusthelp.info/IIE/_cs/Login.aspx" target="_blank">site do Grantee</a>, faça login, e navegue até a página onde aparece o TOA (aquela que tem o "Documents you have uploaded (1)"). Copie o endereço e cole no campo URL.</p>
      <p>O número de documentos já enviados geralmente é 1.</p>
      <p>Você será avisado nesse email quando seu TOA chegar.</p>
      
      <div>
        <input name="email" type="email" class="form-control" placeholder="Email" required autofocus>
        <input name="password" type="password" class="form-control" placeholder="Password" required>
        <input name="url" type="url" class="form-control" placeholder="URL" required>
        <input name="n" type="number" class="form-control" placeholder="Número de documents já enviados" required>
      </div>

      <button class="btn btn-lg btn-primary btn-block" type="submit">Me avise!</button>
    </form>

    <div class="loading" style="display: none;">Cadastrando... Por favor, aguarde até 1 minuto.</div>

    <div class="text-muted text-right footer">
      Criado por <a href="https://www.facebook.com/gberger">Guilherme Berger</a>
    </div>
  <div class="text-muted footer">
    <form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
      <input type="hidden" name="cmd" value="_s-xclick">
      <input type="hidden" name="encrypted" value="-----BEGIN PKCS7-----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-----END PKCS7-----
      ">
      <input type="image" src="https://www.paypalobjects.com/pt_BR/i/btn/btn_donate_SM.gif" border="0" name="submit" alt="PayPal - A maneira fácil e segura de enviar pagamentos online!">
      <img alt="" border="0" src="https://www.paypalobjects.com/en_US/i/scr/pixel.gif" width="1" height="1">
    </form>
    <em>
      Bitcoin donations: 18GR4xXFqcppk92Bq9nwz9v2JvCN3wWyuN
    </em>
  </div>

  </div> 

  <a href="https://github.com/gberger/toansioso"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"></a>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-38564882-8', window.location.host);
  ga('send', 'pageview');
</script>

<script>
  var addAlert = function(klass, msg){
    var alert = $('<div class="alert alert-' + klass + '">' + msg + '</div>')
    $('.alerts').prepend(alert);
  }

  var clearAlerts = function(){
    $('.alert').remove();
  }

  var validateURL = function(url){
    var regex = /^https?\:\/\/mycusthelp\.info\/IIE\/_cs\/CODetails.aspx/;
    return regex.test(url);
  };

  $(function(){
    var $form = $('.toansioso-form');

    $form.on('submit', function(event){
      event.preventDefault();
      clearAlerts();

      var email = $('[name=email]').val();
      var password = $('[name=password]').val();
      var n = $('[name=n]').val();
      var url = $('[name=url]').val();

      if(!validateURL(url)){
        ga('send', 'event', 'SUBMISSION', 'WRONG_URL');
        addAlert('danger', 'Parece que a URL não está correta... Siga novamente as instruções e tente novamente!');
        return;
      }

      ga('send', 'event', 'Submission', 'START');
      var promise = $.post('/register', {email: email, password: password, n: n, url: url});
      $('.toansioso-form').hide();
      $('.loading').show();

      promise.always(function(){
        $('.loading').hide();
      });

      promise.fail(function(res){
        var err = res.responseJSON.error;

        ga('send', 'event', 'Submission', err);

        $form.show();

        if(err === 'WRONG_CREDENTIALS'){
          addAlert('danger', 'Email e/ou senha errados. Por favor, verifique e tente novamente.');
          $('[name=password]').val('');
        } else if(err === 'WRONG_URL'){
          addAlert('danger', 'URL inválida. Por favor, verifique e tente novamente.' );
          $('[name=url]').val('');
        } else if(err === 'DUPLICATE'){
          addAlert('warning', 'Você já se cadastrou. Agora é só esperar! :)')
          $form.hide();
        } else if(err === 'DB_ERROR'){
          addAlert('warning', 'Desculpe, ocorreu um erro no banco de dados. Por favor, tente novamente. Se o error persistir, entre em contato.')
        }

      });

      promise.success(function(){
        addAlert('success', 'Pronto! Agora é só esperar que enviaremos um email quando seu TOA chegar. Boa sorte!');
        ga('send', 'event', 'Submission', 'OK');
      })
    })
  })
</script>

</body>
</html>
